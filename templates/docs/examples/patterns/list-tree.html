{% extends "_layouts/examples.html" %}
{% block title %}List tree{% endblock %}

{% block standalone_css %}patterns_list-tree{% endblock %}

{% block content %}
<ul class="p-list-tree" aria-multiselectable="true" role="tree">
  <li class="p-list-tree__item p-list-tree__item--group" role="treeitem">
    <button class="p-list-tree__toggle" id="sub-1-btn" aria-controls="sub-1" aria-expanded="false">/folder</button>
    <ul class="p-list-tree" role="group" id="sub-1" aria-hidden="true" aria-labelledby="sub-1-btn">
      <li class="p-list-tree__item" role="treeitem">file</li>
    </ul>
  </li>
  <li class="p-list-tree__item" role="treeitem">charm-helpers-sync.yaml</li>
  <li class="p-list-tree__item" role="treeitem">config.yaml</li>
  <li class="p-list-tree__item p-list-tree__item--group" role="treeitem">
    <button class="p-list-tree__toggle" id="sub-2-btn" aria-controls="sub-2" aria-expanded="false">/files</button>
    <ul class="p-list-tree" role="group" id="sub-2" aria-hidden="true" aria-labelledby="sub-2-btn">
      <li class="p-list-tree__item" role="treeitem">default_rsync</li>
      <li class="p-list-tree__item" role="treeitem">nagios_plugin.py</li>
      <li class="p-list-tree__item p-list-tree__item--group" role="treeitem">
        <button class="p-list-tree__toggle" id="sub-3-btn"  aria-controls="sub-3" aria-expanded="false">/plugins</button>
        <ul class="p-list-tree" role="group" id="sub-3" aria-hidden="true" aria-labelledby="sub-3-btn">
          <li class="p-list-tree__item" role="treeitem">check_mem.pl</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<script>
/**
  Toggles the necessary aria-attributes' values on the elements
  to handle showing and hiding them.
  @param {HTMLElement} element The toggle element controlling the visibility.
  @param {Boolean} show Whether to show or hide the target.
*/
function toggleElement(element, show) {
  var target = document.getElementById(element.getAttribute('aria-controls'));

  if (target) {
    element.setAttribute('aria-expanded', show);
    target.setAttribute('aria-hidden', !show);
  }
}

/**
  Attaches event listeners for the list tree toggle.
  @param {HTMLElement} listTreeToggle The list tree toggle element.
*/
function setupListTreeToggle(listTreeToggle) {
  listTreeToggle.addEventListener('click', function(event) {
    event.preventDefault();
    var expand = this.getAttribute('aria-expanded') === 'true' ? false : true;

    if (!shouldToggleCollapse(event, listTreeToggle, expand)) {
      return;
    }

    toggleElement(listTreeToggle, expand);
  });
}

/**
 * Determines if the collapse should be toggled based on the event and the node.
 * @param {MouseEvent} event - The event that triggered the toggle.
 * @param {HTMLElement} node - The node to toggle the collapse on.
 * @param {Boolean} expand - Whether the node should be expanded or collapsed.
 * @returns {Boolean} - Whether the collapse should be toggled.
 */
function shouldToggleCollapse(event, node, expand) {
  // If the button is expanded, ignore collapsing it if the click is on the button text. User must click the icon pseudo-element.
  return expand || event.clientX < node.getBoundingClientRect().left + (16 * 1.5);
}

/**
 * Adds or removes a class from an element.
 * @param {HTMLElement} element - The element to add or remove the class from.
 * @param {String} className - The class to add or remove.
 * @param {Boolean} add - Whether to add or remove the class.
 */
function setClass(element, className, add) {
  if (add) {
    element.classList.add(className);
  } else {
    element.classList.remove(className);
  }
}

/**
 * Attaches event listeners for the list tree link.
 * @param {HTMLElement} listTreeLink - `.p-list-tree__toggle` or `.p-list-tree__item` element to set up.
 * @param {HTMLElement[]} otherTreeLinks - Other `.p-list-tree__toggle` or `.p-list-tree__item` elements on the page.
 */
function setupListTreeLink(listTreeLink, otherTreeLinks) {
  listTreeLink.addEventListener('click', function(event) {
    event.preventDefault();

    setClass(listTreeLink, 'is-active', true);

    otherTreeLinks.forEach(otherTreeLink => {
      setClass(otherTreeLink, 'is-active', false);
    })
  });
}

// Set up all list trees on the page.
var listTreeToggles = document.querySelectorAll('.p-list-tree__toggle');
for (var i = 0, l = listTreeToggles.length; i < l; i++) {
  setupListTreeToggle(listTreeToggles[i]);
}

// Set up all the links on the page.
var listTreeItems = document.querySelectorAll('.p-list-tree__item:not(.p-list-tree__item--group)');
var listTreeLinkItems = [...listTreeToggles, ...listTreeItems];
for (var i = 0; i < listTreeLinkItems.length; i++) {
  setupListTreeLink(
    listTreeLinkItems[i],
    // all items besides this one
    listTreeLinkItems.filter((_, j) => i !== j)
  );
}

</script>
{% endblock %}
