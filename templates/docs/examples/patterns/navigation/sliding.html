{% extends "_layouts/examples.html" %}
{% block title %}Navigation / Sliding{% endblock %}

{% block standalone_css %}patterns_navigation{% endblock %}

{% block content %}
<header id="navigation" class="p-navigation is-dark is-sliding">
  <div class="p-navigation__row">
    <div class="p-navigation__banner">
      <div class="p-navigation__tagged-logo">
        <a class="p-navigation__link" href="#">
          <div class="p-navigation__logo-tag">
            <img class="p-navigation__logo-icon" src="https://assets.ubuntu.com/v1/82818827-CoF_white.svg" alt="" >
          </div>
          <span class="p-navigation__logo-title">Ubuntu</span>
        </a>
      </div>
      <ul class="p-navigation__items">
        <li class="p-navigation__item">
          <button class="js-menu-button p-navigation__link">Menu</button>
        </li>
      </ul>
    </div>
    <nav class="p-navigation__nav">
      <div class="p-navigation__plane" id="main-nav" aria-label="Example main" data-level="0">
        <ul class="p-navigation__items">
          <li class="p-navigation__item is-selected">
            <a class="p-navigation__link" href="#">Products</a>
          </li>
          <li class="p-navigation__item">
            <a class="p-navigation__link" href="#">Services</a>
          </li>
          <li class="p-navigation__item">
            <a class="p-navigation__link" href="#">Partners</a>
          </li>
          <li class="p-navigation__item--dropdown-toggle" id="link-1">
            <button href="#link-1-menu" aria-controls="link-1-menu" class="p-navigation__link">
              LXD
            </button>
            <ul class="p-navigation__dropdown" id="link-1-menu" aria-hidden="true" data-level="1">
              <li class="p-navigation__item--dropdown-close" id="link-1-back">
                <button href="#link-1-menu" aria-controls="link-1-menu" class="p-navigation__link js-back">
                  Back
                </button>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Introduction</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">News</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Getting started - Command line</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Getting started - OpenStack</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Getting started - OpenNebula</a>
              </li>
            </ul>
          </li>
          <li class="p-navigation__item--dropdown-toggle" id="link-2">
            <button href="#link-2-menu" aria-controls="link-2-menu" class="p-navigation__link">
              LXCFS
            </button>
            <ul class="p-navigation__dropdown" id="link-2-menu" aria-hidden="true" data-level="1">
              <li class="p-navigation__item--dropdown-close" id="link-2-back">
                <button href="#link-2-menu" aria-controls="link-2-menu" class="p-navigation__link js-back">
                  Back
                </button>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Introduction</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">News</a>
              </li>
              <li>
                <a href="#" class="p-navigation__dropdown-item">Getting started</a>
              </li>
              <li class="p-navigation__item--dropdown-toggle" id="link-4">
                <button href="#link-4-menu" aria-controls="link-4-menu" class="p-navigation__link">
                  Nested Layer
                </button>
                <ul class="p-navigation__dropdown" id="link-4-menu" aria-hidden="true" data-level="2">
                  <li class="p-navigation__item--dropdown-close" id="link-4-back">
                    <button href="#link-4-menu" aria-controls="link-4-menu" class="p-navigation__link js-back">
                      Back
                    </button>
                  </li>
                  <li>
                    <a href="#" class="p-navigation__dropdown-item">Introduction</a>
                  </li>
                  <li>
                    <a href="#" class="p-navigation__dropdown-item">News</a>
                  </li>
                  <li>
                    <a href="#" class="p-navigation__dropdown-item">Getting started</a>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </nav>
  </div>
</header>

<style>
  body { margin: 0; }
</style>

<script>
  document.querySelector('.js-menu-button').addEventListener('click', function(e) {
    if (window.location.hash === '#navigation') {
      window.location.hash = '';
      e.target.innerHTML = 'Menu';
    } else {
      window.location.hash = 'navigation';
      e.target.innerHTML = 'Close menu';
    }
  });

  const navPlane = document.getElementById("main-nav");

  const toggles = document.querySelectorAll('.p-navigation__link[aria-controls]:not(.js-back)')

  const toggleFocusableListItems = () => {
    const hiddenListItems = document.querySelectorAll('.p-navigation__dropdown[aria-hidden="true"] li');
    const shownListItems = document.querySelectorAll('.p-navigation__dropdown[aria-hidden="false"] li');

    hiddenListItems.forEach(function(el) {
      el.children[0].setAttribute('tabindex', '-1');
    });

    shownListItems.forEach(function(el) {
      el.children[0].setAttribute('tabindex', '0');
    });
  }

  toggleFocusableListItems();

  const resetToggles = (exception) => {
    toggles.forEach(function(el) {
      const target = document.getElementById(el.getAttribute('aria-controls'));
      if(target === exception){
        return;
      }
      target.setAttribute('aria-hidden', 'true');
      el.parentNode.classList.remove('is-active');
      el.parentNode.parentNode.classList.remove('is-active');
      toggleFocusableListItems();
    });
  }

    document.addEventListener('click', function (event) {
      const target = event.target;
      if (target.closest) {
        if (!target.closest('.p-navigation')) {
          resetToggles();
        }
      }
    });

  toggles.forEach(function(el) {
    el.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.getElementById(el.getAttribute('aria-controls'));
      const isNested = target.parentNode.parentNode.classList.contains('p-navigation__dropdown');

      if(!isNested){
        resetToggles(target);
      }
      if(target.getAttribute('aria-hidden') === 'true') {
        target.setAttribute('aria-hidden', 'false');
        el.parentNode.classList.add('is-active');
        el.parentNode.parentNode.classList.add('is-active');
      } else {
        target.setAttribute('aria-hidden', 'true');
        el.parentNode.classList.remove('is-active');
        el.parentNode.parentNode.classList.remove('is-active');
      }
      toggleFocusableListItems();
    });
  });

  document.querySelectorAll('.js-back').forEach(function(el) {
    el.addEventListener('click', function(e) {
      e.preventDefault();
      const target = el.parentNode.parentNode;
      target.setAttribute('aria-hidden', 'true');
      el.closest(".is-active").classList.remove('is-active');
      el.closest(".is-active").classList.remove('is-active');
      toggleFocusableListItems();
    });
  });
</script>
{% endblock %}