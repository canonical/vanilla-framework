{#
  Helper macro to render the article title with optional link and attributes.

  Parameters:
    title (object): Title configuration
      text (string): The title text
      link (object) (optional): Link attributes
      attrs (object) (optional): Additional HTML attributes
#}
{%- macro _article_title(title={}) -%}
  <a
    class="article-link {{ title.get("link", {}).get("class", "") }}"
    {% for attr, value in title.get("link", {}).items() -%}
        {% if attr != "class" %}
          {{ attr }}="{{ value }}"
        {% endif %}
    {%- endfor -%}
  >
    <h3
      class="p-article-block__title article-title {{ title.get("class", "") }}"
      {% for attr, value in title.items() -%}
        {%- if attr not in ["text", "link", "class"] -%}
          {{ attr }}="{{ value }}"
        {%- endif -%}
      {%- endfor -%}>
      {{- title.get("text", "") | trim -}}
    </h3>
  </a>
{%- endmacro -%}

{#
  Helper macro to render the article description.

  Parameters:
    description (object): Description configuration
      text (string): The description text
      attrs (object) (optional): Additional HTML attributes
#}
{%- macro _article_description(description={}) -%}
  <p class="p-article-block__description article-excerpt{{ description.get("attrs", {}).get("class", "") -}}"
    {% for attr, value in description.get("attrs", {}).items() -%}
      {% if attr != "class" %}
        {{ attr }}="{{ value }}"
      {% endif %}
    {%- endfor -%}
  >
    {{- description.get("text", "") | trim -}}
  </p>

{%- endmacro -%}

{#
  Helper macro to render the article metadata with authors and date.

  Parameters:
    authors (array): List of author objects
      text (string): Author name
      link (object) (optional): Link attributes for the author

    date (object): Date configuration
      text (string): The date text
      attrs (object) (optional): Additional HTML attributes for the time element
#}
{%- macro _article_metadata(authors=[], date={}) -%}
  {% set has_authors = authors | length > 0 %}
  {% set has_date = date.get("text", "") | length > 0 %}
  {%- set date_attrs = date.get("attrs", {}) -%}
  {%- set date_text = date.get("text", "") | trim -%}

  <p class="p-article-block__metadata">
    <small class="p-article-block__metadata-item u-no-margin--bottom">
      <span class="article-author">
        {%- for author in authors -%}
          {%- set author_text = author.get("text", "") | trim -%}
          {%- set author_link_attrs = author.get("link", {}) -%}
          {% if author_link_attrs -%}
              <a
              {% for attr, value in author_link_attrs.items() -%}
                  {{ attr }}="{{ value }}"
              {%- endfor -%}
              >
          {%- endif -%}
          {{- author_text -}}
          {%- if author_link_attrs -%}</a>{%- endif -%}
          {%- if not loop.last -%}, {% endif -%}
        {%- endfor -%}
      </span>
    </small>
    <small class="p-article-block__metadata-item u-no-margin--bottom">
      <time
        datetime="{{ date_text }}"
        class="article-time {{ date_attrs.get("class", "") }}"
        {% for attr, value in date_attrs.items() -%}
          {% if attr not in ["datetime", "class"] %}
            {{ attr }}="{{ value }}"
          {% endif %}
        {%- endfor -%}
      >
        {{- date_text -}}
      </time>
    </small>
  </p>
{%- endmacro -%}

{#
  Blog article block pattern - displays a single blog article with title, description and metadata.

  Parameters:
    article_config (object) (required): Article configuration
      title (object) (required): Title configuration
        text (string) (required): The title text
        link (object) (optional): Link attributes for the title
        attrs (object) (optional): Additional attributes for the title
      description (object) (optional): Description configuration
        text (string) (required): Description text
        attrs (object) (optional): Additional attributes for description paragraph
      metadata (object) (optional): Metadata configuration
        authors (array) (optional): List of author objects
          text (string) (required): Author name
          link (object) (optional): Author link attributes
        date (object) (optional): Date configuration
          text (string) (required): Date text
          attrs (object) (optional): Date element attributes
      image_html (string) (optional): Image to render before the title.
        When used with vf_blog macro, this is automatically populated with a 16:9 cover image
        from the article's image configuration.

    attrs (object) (optional): Additional attributes for the resource block
#}
{%- macro vf_article_block(article_config={}, attrs={}) -%}
    {%- set title = article_config.get("title", {}) -%}
    {%- set description = article_config.get("description", {}) -%}
    {%- set _ = description.setdefault('attrs', {}) -%}
    {%- set metadata = article_config.get("metadata", {}) -%}
    {%- set image_html = article_config.get("image_html", "") | trim -%}
    {%- set authors = metadata.get("authors", []) -%}
    {%- set date = metadata.get("date", {}) -%}

    <div class="p-article-block {{ attrs.get("class", "") }}"
      {% for attr, value in attrs.items() %}
        {% if attr != "class" %}
          {{ attr }}="{{ value }}"
        {% endif %}
      {%- endfor -%}
    >
      {#-
        Note: p-article-block relies on subgrid to align items vertically across the grid.
        This means that we must always create 4 p-article-block__items, even if some are empty.
        This allows the subgrid to maintain alignment, even when some blocks are missing some items.
        Note that this means `p-article-block__item` elements should never define padding or margin, as this would cause empty items to take up space.
      -#}
        <div class="p-article-block__item">
          {%- if image_html | length > 0 -%}
            <div class="p-article-block__image">
              {{- image_html | safe -}}
            </div>
          {%- endif -%}
        </div>

        <div class="p-article-block__item">
          {{- _article_title(title=title) -}}
        </div>

        <div class="p-article-block__item">
          {{- _article_description(description=description) -}}
        </div>

        <div class="p-article-block__item">
          {{- _article_metadata(authors=authors, date=date) -}}
        </div>
    </div>


{%- endmacro -%}