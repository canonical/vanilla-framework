name: vanillaframework-io
base: ubuntu@22.04
version: '0.1'
summary: A simple, extendable CSS framework.
description: |
  This is the rockcraft for the vanillaframework.io website
license: LGPL-3.0
platforms:
  amd64:

extensions:
  # https://documentation.ubuntu.com/rockcraft/en/latest/reference/extensions/flask-framework
  - flask-framework

parts:
  build-ui:
    plugin: nil
    source: .
    source-type: local
    build-snaps:
      # Necessary to run `npm`
      - node/22/stable
    override-build: |
      # set error & debugging flags - exit on error and pipe commands to the console
      set -eux
      # install dependencies
      npm install -g yarn
      yarn install
      # https://documentation.ubuntu.com/rockcraft/en/latest/common/craft-parts/how-to/override_build/
      # Vanilla's `build` dir is pointed to by `templates/static/build` symlink - it must be present at runtime
      yarn run build
      mkdir -p "$CRAFT_PART_INSTALL/flask/app"
      cp -r build "$CRAFT_PART_INSTALL/flask/app/"
  flask-framework/install-app:
    after:
      - build-ui
    # Add all files that must be available to the Flask app at runtime.
    prime:
      - flask/app/.env
        # Flask-framework / PAAS charm entrypoint - re-exports `webapp/app.py`
      - flask/app/app.py
        # App entrypoint
        # flask/app/build is also needed but is manually staged in the build-ui step
      - flask/app/webapp
      - flask/app/templates
      - flask/app/scripts
      # These YAML files are read by `webapp/app.py` at runtime
      - flask/app/component_tabs.yaml
      - flask/app/deleted.yaml
      - flask/app/releases.yml
      - flask/app/redirects.yaml
      - flask/app/side-navigation.yaml
        # Used on the homepage, release notes page, download pages, to indicate the current version
      - flask/app/package.json
