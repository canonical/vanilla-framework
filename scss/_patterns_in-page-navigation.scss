@import 'settings';

/*
  @classreference
  in-page-navigation:
    Root element:
        .p-in-page-navigation:
            Side navigation in default variant.
        .p-in-page-navigation--icons:
            Side navigation with item icons.
        .p-in-page-navigation--accordion:
            Side navigation with expanding accordion items.
        .p-in-page-navigation--raw-html:
            Raw HTML version of side navigation (used with links generated by an external service).
        "&.is-drawer-expanded":
            Set `.is-drawer-expanded` when side navigation drawer is open on small screens.
        "&.is-drawer-collapsed":
            Set `.is-drawer-collapsed` when side navigation drawer is closed on small screens.
        "&.is-drawer-hidden":
            Set `.is-drawer-hidden` when side navigation drawer is closed on small screens.
        "&.is-sticky":
            Sticky version of side navigation.
        "&.is-dark":
            Side navigation in dark theme (if default is light).
        "&.is-light":
            Side navigation in light theme (if default is dark).

    Overlay:
        .p-in-page-navigation__overlay:
            Screen overlay to display when side navigation drawer is open on small screens.

    Drawer:
        .p-in-page-navigation__container:
            Side navigation drawer (to allow expanding and collapsing the navigation on small screens).

    Drawer header:
        .p-in-page-navigation__container-header:
            Header of the side navigation drawer.

    Toggle button:
        .p-in-page-navigation__toggle:
            Side navigation toggle button (to open side navigation on small screens).
        .p-in-page-navigation__toggle--in-drawer:
            Side navigation toggle button in drawer (to close navigation on small screens).

    Dropdown toggle:
        .p-in-page-navigation__dropdown-toggle:
            Button to toggle between horizontal and vertical dropdown navigation on small/medium screens.
        .p-in-page-navigation__dropdown-toggle-icon:
            Chevron icon inside the dropdown toggle button.

    Items list heading:
        .p-in-page-navigation__heading:
            Heading for side navigation items group (text only).

    Items list:
        .p-in-page-navigation__list:
            Group of side navigation items (usually a `<ul>` element).

    Item element:
        .p-in-page-navigation__item:
            Single item in side navigation (usually a `<li>` element). May contain nested items lists.

    Item link:
        .p-in-page-navigation__link:
            Single link in the side navigation.

    Item text:
        .p-in-page-navigation__text:
            Single text item in side navigation (for items that are not linked).

    Item accordion button:
        .p-in-page-navigation__accordion-button:
            Single accordion button item in side navigation with `.p-in-page-navigation--accordion` variant.

    Item icon:
        .p-in-page-navigation__icon:
            An icon in side navigation item (used with `.p-in-page-navigation--icons` variant).

    Item status:
        .p-in-page-navigation__status:
            A container for status icon or label inside the navigation item.
*/

@mixin vf-p-in-page-navigation {
  // Left border style for the main navigation list
  .p-in-page-navigation__container > .p-in-page-navigation__list {
    @extend %vf-pseudo-border--left;

    &::before {
      background-color: $colors--theme--border-low-contrast;
      width: 3px;
    }
  }

  .p-in-page-navigation__list,
  .p-in-page-navigation__list--secondary {
    @extend %vf-list;
    color: $colors--theme--text-inactive;

    &:last-of-type::after {
      content: none;
    }
  }

  %in-page-navigation__text {
    @include vf-in-page-navigation-spacing-left;

    display: flex;
    padding-bottom: $spv--x-small;
    padding-right: $sph--large;
    padding-top: $spv--x-small;
  }

  .p-in-page-navigation__heading {
    @extend %in-page-navigation__text;
    // reset heading styles
    @extend %common-default-text-properties;
    @extend %small-caps-text;

    display: block;
    font-size: map-get($base-font-sizes, base);
    font-weight: $font-weight-bold;
    margin: 0;
    max-width: none;
    color: $colors--theme--text-default;
    padding-left: unset;
    padding-bottom: $spv--small;
  }

  .p-in-page-navigation__link {
    @include vf-focus-themed;

    display: -webkit-box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;  
    overflow: hidden;
    text-overflow: ellipsis;
    color: $colors--theme--text-muted;

    &:visited {
      color: $colors--theme--text-muted;
    }

    &:hover {
      color: $colors--theme--text-default;
      text-decoration: none;
    }

    // vf-highlight-bar is rendered above focus outline
    // so we need to hide it on focus
    &:focus::before {
      display: none;
    }

    // Display the highlight when focussing in modern browsers that support
    // focus-visible.
    &:focus:not(:focus-visible)::before {
      display: block;
    }

    &.is-active,
    &[aria-current='true'] {
      @extend %vf-pseudo-border--left;
      
      color: $colors--theme--text-default;
      cursor: default;

      &::before {
        background-color: $colors--theme--text-default;
        width: 3px;
      }
    }
  }

  .p-in-page-navigation__text,
  .p-in-page-navigation__link {
    @extend %in-page-navigation__text;

    // nested 2nd level of navigation
    .p-in-page-navigation__item .p-in-page-navigation__item--secondary & {
      @include vf-in-page-navigation-spacing-left($multiplier: 2);
    }
  }

  // SMALL AND MEDIUM SCREEN HORIZONTAL LAYOUT
  @media (max-width: $threshold-6-12-col - 1px) {
    .p-in-page-navigation__container {
      display: flex;
      align-items: center;
      position: relative;
      margin-bottom: $spv--x-large;

      // Full-width bottom border using viewport units
      &::after {
        background-color: $colors--theme--border-low-contrast;
        bottom: 0;
        content: '';
        height: 1px;
        left: 50%;
        position: absolute;
        transform: translateX(-50%);
        width: 100vw;
      }
    }

    // Target only the main top-level list, not nested lists
    .p-in-page-navigation__container > .p-in-page-navigation__list {
      flex: 1;
      min-width: 0;
      overflow-x: auto;
      scroll-behavior: smooth;
      white-space: nowrap;
      margin-bottom: 0;

      scrollbar-width: none; // Firefox
      -ms-overflow-style: none; // IE/Edge

      &::-webkit-scrollbar {
        display: none; // Chrome/Safari/Opera
      }

      // Remove left border
      &::before {
        content: none;
      }
    }

    .p-in-page-navigation__item {
      display: inline;

      // Hide secondary nested lists in horizontal layout
      > .p-in-page-navigation__list {
        display: none;
      }
    }

    .p-in-page-navigation__item--secondary {
      display: none;
    }

    .p-in-page-navigation__heading {
      display: none;
    }

    .p-in-page-navigation__item > .p-in-page-navigation__link {
      display: inline-block;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: $spv--medium $spv--small $spv--medium $spv--large;
      max-width: 50vw;

      // Override active state pseudo-element for horizontal layout
      &.is-active,
      &[aria-current='true'] {
        &::before {
          // Reduce height and center vertically
          height: 50%;
          top: 25%;
        }
      }
    }
  }

  // Medium screens: limit link width to 1/3 of viewport
  @media (min-width: $threshold-4-6-col) and (max-width: $threshold-6-12-col - 1px) {
    .p-in-page-navigation__item > .p-in-page-navigation__link {
      max-width: 33.33vw;
    }
  }

  // DROPDOWN TOGGLE BUTTON
  .p-in-page-navigation__dropdown-toggle {
    align-items: center;
    background: transparent;
    border: 0;
    cursor: pointer;
    display: inline-flex; // Hidden by default, shown on small/medium screens
    flex-shrink: 0;
    justify-content: center;
    margin: 0;
    padding: $spv--large $sph--x-large;
    line-height: $spv--medium;

    &:hover {
      background: $colors--theme--background-hover;
    }

    &:focus {
      @include vf-focus;
    }
  }

  @media (max-width: $threshold-4-6-col) {
    .p-in-page-navigation__dropdown-toggle {
      padding: $spv--large $spv--large;
    }
  }

  .p-in-page-navigation__dropdown-toggle-icon {
    height: map-get($icon-sizes, default);
    width: map-get($icon-sizes, default);
  }

  @media (min-width: $threshold-6-12-col) {
    // make whole navigation sticky on large screens
    .p-in-page-navigation.is-sticky,
    [class*='p-in-page-navigation--'].is-sticky {
      max-height: 100dvh;
      overflow-y: auto;
      position: sticky;
      top: 0;
    }
  }
}
// helper

// elements in side nav should be aligned from left based on grid margin for given screen size
// additional offset is added when icons are used or for nested navigation levels
@mixin vf-in-page-navigation-spacing-left(
  // property to adjust spacing, defaults to `padding-left`
  $prop: padding-left,
  // how many times grid margin width should be multiplied (for nested navigation levels)
  $multiplier: 1,
) {
  #{$prop}: $multiplier * map-get($grid-margin-widths, small);

  @media (min-width: $threshold-4-6-col) {
    #{$prop}: $multiplier * map-get($grid-margin-widths, default);
  }
}
